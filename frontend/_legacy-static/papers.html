<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
      window.__PAGE_META__ = {
        title: '核聚变论文汇总 - 核聚变门户',
        description: '搜集核聚变领域的经典论文与前沿研究，支持关键词筛选与按主题浏览。'
      };
    </script>
    <script src="components/meta.js"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="components/common.js" defer></script>
</head>
<body>
    <div data-component="header"></div>

    <main id="main-content" class="main-content" tabindex="-1">
        <div class="content-page">
            <a href="index.html" class="back-button">← 返回首页</a>

            <h1>核聚变论文汇总</h1>
            <p>本页面集中整理核聚变领域具有代表性的论文、综述与研究报告。数据来自 <code>data/papers.json</code>，可按主题分类浏览，也可通过搜索关键词快速定位目标文献。</p>

            <div class="paper-list" data-paper-slot="经典理论论文"></div>

            <h2>磁约束聚变</h2>
            <h3>托卡马克物理</h3>
            <div class="paper-list" data-paper-slot="托卡马克物理"></div>
            <h3>仿星器物理</h3>
            <div class="paper-list" data-paper-slot="仿星器物理"></div>

            <h2>惯性约束聚变</h2>
            <div class="paper-list" data-paper-slot="惯性约束聚变"></div>

            <h2>等离子体物理基础</h2>
            <div class="paper-list" data-paper-slot="等离子体物理基础"></div>

            <h2>材料科学与工程</h2>
            <div class="paper-list" data-paper-slot="材料科学与工程"></div>

            <h2>聚变堆设计与技术</h2>
            <div class="paper-list" data-paper-slot="聚变堆设计与技术"></div>

            <h2>先进约束概念</h2>
            <div class="paper-list" data-paper-slot="先进约束概念"></div>

            <h2>最新研究进展</h2>
            <div class="paper-list" data-paper-slot="最新研究进展"></div>

            <h2>常用论文与数据资源</h2>
            <div class="links-grid">
                <a href="https://ui.adsabs.harvard.edu/" class="link-card" target="_blank">
                    <div class="link-title">NASA ADS</div>
                    <div class="link-description">天体物理与等离子体论文数据库，支持聚变主题检索。</div>
                </a>
                <a href="https://arxiv.org/list/physics.plasm-ph/recent" class="link-card" target="_blank">
                    <div class="link-title">arXiv Plasma Physics</div>
                    <div class="link-description">等离子体物理与聚变领域预印本更新最快的平台。</div>
                </a>
                <a href="https://www.iaea.org/publications" class="link-card" target="_blank">
                    <div class="link-title">IAEA Publications</div>
                    <div class="link-description">国际原子能机构出版物，涵盖 ITER、聚变会议论文与技术报告。</div>
                </a>
                <a href="https://www.sciencedirect.com/journal/nuclear-fusion" class="link-card" target="_blank">
                    <div class="link-title">Nuclear Fusion Journal</div>
                    <div class="link-description">核聚变领域权威期刊，获取最新同行评审论文。</div>
                </a>
            </div>
        </div>
    </main>

    <div data-component="footer"></div>

    <script>
        (() => {
            const DATA_URL = 'data/papers.json';
            const containerMap = new Map();
            const renderedCards = [];

            document.querySelectorAll('[data-paper-slot]').forEach((slot) => {
                containerMap.set(slot.dataset.paperSlot, slot);
            });

            const searchInput = createSearchInput();

            async function init() {
                try {
                    const response = await fetch(DATA_URL, { cache: 'no-cache' });
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }

                    const papers = await response.json();
                    if (!Array.isArray(papers) || !papers.length) {
                        throw new Error('empty');
                    }

                    renderPapers(papers);
                    applySearch('');
                } catch (error) {
                    console.error('[papers] 数据加载失败', error);
                    showError();
                }
            }

            function createSearchInput() {
                const firstHeading = document.querySelector('.content-page h1');
                if (!firstHeading || !firstHeading.parentElement) {
                    return null;
                }

                const input = document.createElement('input');
                input.type = 'search';
                input.className = 'paper-search';
                input.placeholder = '搜索论文标题、作者或关键词…';
                input.setAttribute('aria-label', '搜索核聚变论文');

                input.addEventListener('input', (event) => {
                    applySearch((event.target.value || '').trim().toLowerCase());
                });

                firstHeading.parentElement.insertBefore(input, firstHeading.nextSibling);
                return input;
            }

            function renderPapers(papers) {
                containerMap.forEach((slot) => {
                    slot.innerHTML = '';
                });
                renderedCards.length = 0;

                papers.forEach((paper) => {
                    const targetKey = Array.isArray(paper.tags)
                        ? paper.tags.find(tag => containerMap.has(tag))
                        : null;

                    const container = targetKey ? containerMap.get(targetKey) : null;
                    if (!container) {
                        console.warn('[papers] 无匹配容器：', paper.title);
                        return;
                    }

                    const card = createPaperCard(paper);
                    container.appendChild(card);
                    renderedCards.push(card);
                });
            }

            function createPaperCard(paper) {
                const wrapper = document.createElement('article');
                wrapper.className = 'paper-card';
                wrapper.dataset.searchText = [
                    paper.title,
                    paper.authors,
                    paper.venue || '',
                    paper.year ? String(paper.year) : '',
                    Array.isArray(paper.tags) ? paper.tags.join(' ') : '',
                    paper.abstract || ''
                ].join(' ').toLowerCase();

                const title = document.createElement('div');
                title.className = 'paper-title';
                title.textContent = paper.title;

                const authors = document.createElement('div');
                authors.className = 'paper-authors';
                authors.textContent = paper.authors;

                const venue = document.createElement('div');
                venue.className = 'paper-journal';
                const parts = [];
                if (paper.venue) parts.push(paper.venue);
                if (paper.year) parts.push(paper.year);
                venue.textContent = parts.join(', ');

                const abstract = document.createElement('p');
                abstract.textContent = paper.abstract || '';

                wrapper.append(title, authors, venue, abstract);

                if (paper.url) {
                    const link = document.createElement('a');
                    link.className = 'paper-link';
                    link.href = paper.url;
                    link.target = '_blank';
                    link.rel = 'noopener';
                    link.textContent = '查看原文';
                    wrapper.appendChild(link);
                }

                wrapper.style.opacity = '0';
                wrapper.style.transform = 'translateY(20px)';
                wrapper.style.transition = 'opacity 0.4s ease, transform 0.4s ease';

                observer.observe(wrapper);
                return wrapper;
            }

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                        observer.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            function applySearch(keyword) {
                const query = keyword || '';
                renderedCards.forEach(card => {
                    const matches = !query || card.dataset.searchText.includes(query);
                    card.hidden = !matches;
                });
            }

            function showError() {
                containerMap.forEach((slot) => {
                    slot.innerHTML = '<p class="paper-error">未能加载论文数据，请稍后重试。</p>';
                });
            }

            init();

            const linkCards = document.querySelectorAll('.link-card');
            const linkObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                        linkObserver.unobserve(entry.target);
                    }
                });
            }, { threshold: 0.1 });

            linkCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = `opacity 0.4s ease ${index * 0.1}s, transform 0.4s ease ${index * 0.1}s`;
                linkObserver.observe(card);
            });
        })();
    </script>
</body>
</html>
