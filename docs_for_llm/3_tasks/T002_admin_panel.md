# T002 – 后台管理面板

## 概述
完善后台管理面板，使管理员能够创建、编辑、删除文章，并管理分类、标签与用户角色，确保与前端内容展示/发布流程打通。

- **优先级**：🔥 高
- **当前状态**: 🛠 进行中
- **涉及范围**：Express API、Prisma 模型、Next.js 管理界面、权限控制

## 目标
1. 提供安全可靠的文章 CRUD 能力，并支持草稿/发布状态；
2. 引入分类、标签、作者角色管理，保障内容治理；
3. 与前端（含静态站迁移 T009）共享数据源与权限策略。

## 现状概览
- 后端 `POST /articles`、`PUT /articles/:id`、`DELETE /articles/:id` 已实现基础接口；
- 前端 `app/admin` 支持文章列表与删除，但缺乏编辑表单、权限校验和分类标签能力；
- Prisma 模型尚未包含分类/标签，用户角色仅有 `user` / `admin` 默认值。

## 待办清单
- [ ] 设计文章状态字段（`draft`/`published`）与更新时间戳；
- [ ] 扩展 Prisma：新增 `Category`、`Tag`、关联表，并更新服务端 API；
- [ ] 实现文章编辑/创建表单，支持富文本或 Markdown 输入与校验；
- [ ] 落实角色权限（作者、编辑、管理员）与细粒度授权；
- [ ] 为后台操作增加错误提示、加载状态与表单验证；
- [ ] 与 T009/T003 协调共享的内容模型与接口定义；
- [ ] 编写操作审计或活动日志的基本方案。

## 依赖与协作
- 需要数据库迁移计划与回滚策略；
- 与前端团队对齐文章编辑器选型（Markdown or 富文本）；
- 与 T009 协调时间线/链接/论文等新模型的共存方式；
- 与运维协调部署及环境变量更新。
- 2025-11-05 同步：需确认 `TimelineEvent.relatedArticleId` 的录入流程（是否允许后台直接关联文章），并输出标签/分类数据结构供 T003 复用。临时结论：
  - 文章新增字段：`publishedAt`（发布日期）、`excerpt`（<= 160 字）、`coverImageUrl`、`categoryId`、`status`（`draft`/`review`/`published`）、`timelineYear`（可选，供 `/site/history` 过滤）。
  - 分类（`Category`）：`id`、`slug`、`name`、`description`、`sortOrder`；标签（`Tag`）：`id`、`slug`、`name`；两者均需后台 CRUD。
  - 后台表单需提供 “关联时间线事件” 的选择器（基于 `/api/timeline?order=desc&limit=50`），写入 `TimelineEvent.relatedArticleId`。
  - 角色权限：作者可草稿 + 提交审核，编辑可改稿并设为 `review`，管理员可发布并管理分类/标签。
- 2025-11-05 补充：友情链接后台需支持 `LinkSection` / `LinkGroup` / `Link` 的增删改排序，计划在管理界面提供结构化编辑与拖拽排序能力。

## 验收标准
- 管理员可完整创建/更新/删除文章，操作可追踪；
- 角色权限生效，非授权用户无法访问敏感接口；
- 分类、标签在前端展示正确，且可在后台维护；
- 通过手动测试（含移动端）确认交互无明显问题。

---

### 状态校验（2025-11-21 13:53 CST）
- 任务仍标记为进行中，与 `Tasks Overview` 保持一致；暂无新进度记录，等待后端/前端实施更新。
- 依赖 T009/T003 的数据模型协同关系依旧有效，需在后续开发时同步更新此文件与 `dev_notes.md`。
